from abc import ABCMeta
from mmcv.runner import BaseModule, auto_fp16

custom_colors = [
    (237, 123, 187),
    (204, 222, 58),
    (119, 194, 221),
    (224, 138, 51),
    (134, 208, 69),
    (191, 56, 154),
    (128, 154, 238),
    (245, 207, 103),
    (106, 133, 202),
    (212, 175, 54),
    (171, 220, 249),
    (153, 216, 191),
    (243, 114, 176),
    (102, 194, 244),
    (255, 165, 109),
    (160, 160, 160),
    (173, 216, 230),
    (147, 112, 219),
    (255, 215, 0),
    (135, 206, 235),
    (255, 127, 80),
    (220, 20, 60),
    (139, 0, 139),
    (165, 42, 42),
    (255, 99, 71),
    (127, 255, 212),
    (124, 252, 0),
    (255, 20, 147),
    (255, 250, 240),
    (152, 251, 152),
    (75, 0, 130),
    (255, 228, 196),
    (70, 130, 180),
    (255, 69, 0),
    (46, 139, 87),
    (255, 222, 173),
    (218, 165, 32),
    (0, 191, 255),
    (238, 130, 238),
    (244, 164, 96),
    (139, 69, 19),
    (0, 128, 128),
    (255, 105, 180),
    (128, 128, 0),
    (255, 192, 203),
    (221, 160, 221),
    (250, 128, 114),
    (34, 139, 34),
    (255, 239, 213),
    (100, 149, 237),
    (255, 160, 122),
    (222, 184, 135),
    (32, 178, 170),
    (210, 105, 30),
    (72, 61, 139),
    (0, 250, 154),
    (186, 85, 211),
    (255, 218, 185),
    (176, 224, 230),
    (255, 20, 147),  # 亮粉色
    (204, 222, 58),  # 黄绿色
    (119, 194, 221),  # 天蓝色
    (255, 69, 0),  # 亮橙红
    (134, 208, 69),  # 橄榄绿
    (222, 184, 135),  # 浅驼色
    (153, 216, 191),  # 薄荷绿
    (244, 164, 96),  # 沙棕色
    (237, 123, 187),  # 樱花粉
    (176, 224, 230),  # 淡青色
    (255, 218, 185),  # 奶油杏
    (238, 130, 238),  # 薰衣草紫
    (72, 61, 139),  # 深蓝紫
    (139, 69, 19),  # 深棕
    (46, 139, 87),  # 森林绿
    (165, 42, 42),  # 红棕色
    (124, 252, 0),  # 荧光绿
    (0, 191, 255),  # 湖蓝
    (255, 215, 0),  # 金黄色
    (255, 105, 180),  # 玫红色
    (218, 165, 32),  # 金属金
    (147, 112, 219),  # 中紫
    (34, 139, 34),  # 森林绿
    (255, 165, 109),  # 陶土橙
    (70, 130, 180),  # 钢蓝
    (106, 133, 202),  # 灰蓝
    (32, 178, 170),  # 蓝绿
    (135, 206, 235),  # 天蓝
    (224, 138, 51),  # 南瓜橙
    (255, 127, 80),  # 珊瑚色
    (245, 207, 103),  # 香槟金
    (220, 20, 60),  # 深红
    (255, 182, 193),  # 粉红
    (154, 205, 50),  # 黄绿
    (0, 139, 139),  # 深青
    (255, 140, 0),  # 深橙
    (148, 0, 211),  # 深紫
    (255, 0, 255),  # 洋红
    (0, 255, 255),  # 青色
    (255, 255, 0),  # 黄色
    (0, 0, 255),  # 蓝色
    (255, 0, 0),  # 红色
    (0, 255, 0),  # 绿色
    (128, 0, 128),  # 紫色
    (128, 128, 128),  # 灰色
    (192, 192, 192),  # 银灰色
    (255, 235, 205),  # 杏仁白
    (240, 230, 140),  # 卡其色
    (245, 245, 220),  # 米色
    (255, 228, 225),  # 玫瑰棕
    (240, 255, 240),  # 蜜瓜绿
    (245, 255, 250),  # 薄荷奶油
    (240, 248, 255),  # 淡蓝
    (230, 230, 250),  # 薰衣草灰
    (255, 240, 245),  # 淡粉
    (250, 240, 230),  # 亚麻色
    (253, 245, 230),  # 旧蕾丝
    (255, 250, 250),  # 雪白
    (248, 248, 255),  # 幽灵白
]


class BaseModel(BaseModule, metaclass=ABCMeta):
    """Base class for models"""

    def __init__(self):
        super(BaseModel, self).__init__()
        self.fp16_enabled = False

    def add_batch_input_shape(self, img, img_metas):
        batch_input_shape = tuple(img.size()[-2:])
        for img_meta in img_metas:
            img_meta["batch_input_shape"] = batch_input_shape

    @auto_fp16(apply_to=("img",))
    def forward(self, img, ref_expr_inds, img_metas, return_loss=True, **kwargs):
        """Calls either :func:`forward_train` or :func:`forward_test` depending
        on whether ``return_loss`` is ``True``.
        """
        self.add_batch_input_shape(img, img_metas)

        if return_loss:
            return self.forward_train(img, ref_expr_inds, img_metas, **kwargs)
        else:
            return self.forward_test(img, ref_expr_inds, img_metas, **kwargs)
